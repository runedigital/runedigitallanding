<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>RUNE // PHAGE [GOLDEN_MASTER]</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;800&display=swap');

        :root {
            --primary: #00ffea;
            --danger: #ff0055;
            --bg: #050505;
            --panel: #0a0a0a;
        }

        body {
            margin: 0;
            background: var(--bg);
            color: var(--primary);
            font-family: 'JetBrains Mono', monospace;
            overflow: hidden;
            cursor: none !important; 
        }

        /* LAYERS */
        #ui-layer {
            position: relative; z-index: 10;
            padding: 40px; height: 100vh; box-sizing: border-box;
            display: flex; flex-direction: column;
            transition: opacity 2s;
        }
        
        #matrix-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 50; pointer-events: none; opacity: 0; transition: opacity 1s;
        }

        #blackout {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 100; pointer-events: none;
            opacity: 0; transition: opacity 5s ease-in;
        }

        /* UI STYLES */
        header {
            display: flex; justify-content: space-between; align-items: flex-end;
            border-bottom: 2px solid var(--primary); padding-bottom: 20px; margin-bottom: 40px;
        }
        h1 { margin: 0; font-size: 3rem; letter-spacing: -2px; text-transform: uppercase; }
        
        .status { 
            font-size: 1rem; color: var(--primary); animation: blink 1s infinite; 
            font-weight: bold;
        }

        .grid-container {
            display: grid; grid-template-columns: repeat(4, 1fr); grid-template-rows: repeat(3, 1fr);
            gap: 20px; flex-grow: 1;
        }

        .node {
            background: var(--panel); border: 1px solid #333; padding: 20px; position: relative;
            transition: all 0.1s; 
        }
        .node::before { content: 'NODE_ACTIVE'; position: absolute; top: 10px; left: 10px; font-size: 10px; opacity: 0.5; }
        .node-graph { width: 100%; height: 4px; background: #333; margin-top: 40px; position: relative; }
        .node-graph::after { content: ''; position: absolute; top: 0; left: 0; height: 100%; width: 70%; background: var(--primary); }

        #trigger-box { position: absolute; bottom: 40px; right: 40px; text-align: right; }

        button {
            background: transparent; border: 2px solid var(--danger); color: var(--danger);
            padding: 15px 40px; font-family: inherit; font-size: 1.2rem; font-weight: bold;
            cursor: none; text-transform: uppercase; transition: 0.3s;
        }
        button:hover { background: var(--danger); color: #000; box-shadow: 0 0 20px var(--danger); }

        #end-btn {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            border: 2px solid #00ff00; color: #00ff00; background: #000;
            font-size: 2rem; padding: 30px 60px; z-index: 20;
            display: none; animation: pulse 2s infinite;
        }
        #end-btn:hover { background: #00ff00; color: #000; box-shadow: 0 0 50px #00ff00; }

        canvas#swarm { position: fixed; top: 0; left: 0; z-index: 15; pointer-events: none; width: 100%; height: 100%; }

        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(0, 255, 0, 0.4); } 70% { box-shadow: 0 0 0 20px rgba(0, 255, 0, 0); } 100% { box-shadow: 0 0 0 0 rgba(0, 255, 0, 0); } }
    </style>
</head>
<body>

    <canvas id="swarm"></canvas>
    <canvas id="matrix-layer"></canvas>
    <div id="blackout"></div>

    <button id="end-btn">EXECUTE SYSTEM SHUTDOWN</button>

    <div id="ui-layer">
        <header class="food-item">
            <h1>Main_Net // Node 01</h1>
            <div class="status">SYSTEM INTEGRITY: 100%</div>
        </header>

        <div class="grid-container">
            <div class="node food-item">SERVER_A1 <div class="node-graph"></div></div>
            <div class="node food-item">SERVER_A2 <div class="node-graph"></div></div>
            <div class="node food-item">SERVER_A3 <div class="node-graph"></div></div>
            <div class="node food-item">SERVER_A4 <div class="node-graph"></div></div>
            
            <div class="node food-item">DATABASE_B1 <div class="node-graph" style="width:40%"></div></div>
            <div class="node food-item">DATABASE_B2 <div class="node-graph" style="width:80%"></div></div>
            <div class="node food-item">DATABASE_B3 <div class="node-graph" style="width:60%"></div></div>
            <div class="node food-item">DATABASE_B4 <div class="node-graph" style="width:90%"></div></div>

            <div class="node food-item">PROXY_C1 <div class="node-graph"></div></div>
            <div class="node food-item">PROXY_C2 <div class="node-graph"></div></div>
            <div class="node food-item">PROXY_C3 <div class="node-graph"></div></div>
            <div class="node food-item">SECURITY_ROOT <div class="node-graph"></div></div>
        </div>

        <div id="trigger-box">
            <p style="color:#666; font-size: 10px; margin-bottom: 10px;">CAUTION: IRREVERSIBLE</p>
            <button id="start-btn">INITIATE PROTOCOL 99</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('swarm');
        const ctx = canvas.getContext('2d');
        
        const mCanvas = document.getElementById('matrix-layer');
        const mCtx = mCanvas.getContext('2d');
        let matrixActive = false;
        let drops = [];
        
        let width, height;
        let bots = [];
        let foodSources = [];
        let active = false;
        let endSequenceReady = false;

        // CURSOR VARIABLES
        let mx = 0, my = 0;
        let cx = 0, cy = 0; 

        window.addEventListener('mousemove', e => { mx = e.clientX; my = e.clientY; });

        function resize() {
            width = window.innerWidth;
            height = window.innerHeight;
            const dpr = window.devicePixelRatio || 1;
            
            canvas.width = width * dpr; canvas.height = height * dpr; ctx.scale(dpr, dpr);
            mCanvas.width = width; mCanvas.height = height;
            
            const columns = mCanvas.width / 20;
            drops = [];
            for(let x = 0; x < columns; x++) drops[x] = 1;

            if(active) scanDOM();
        }
        window.addEventListener('resize', resize);
        resize();

        function scanDOM() {
            foodSources = [];
            const elements = document.querySelectorAll('.food-item');
            elements.forEach(el => {
                const rect = el.getBoundingClientRect();
                if (rect.width > 0 && el.style.opacity !== '0') {
                    foodSources.push({
                        dom: el,
                        x: rect.left, y: rect.top, w: rect.width, h: rect.height,
                        cx: rect.left + rect.width / 2, cy: rect.top + rect.height / 2,
                        integrity: 100
                    });
                }
            });
        }

        // UPDATE INTEGRITY PERCENTAGE
        function updateSystemStatus() {
            if (!active) return;
            let totalIntegrity = 0;
            let maxIntegrity = foodSources.length * 100;
            
            foodSources.forEach(f => totalIntegrity += f.integrity);
            
            // If we have no food sources, skip
            if(maxIntegrity === 0) return;

            let pct = Math.floor((totalIntegrity / maxIntegrity) * 100);
            // Clamp to 0
            if(pct < 0) pct = 0;

            const statusEl = document.querySelector('.status');
            
            if (pct === 0) {
                statusEl.innerText = "SYSTEM STATUS: CRITICAL FAILURE";
                statusEl.style.color = "#ff0000";
                statusEl.style.textShadow = "0 0 10px red";
            } else {
                statusEl.innerText = `SYSTEM INTEGRITY: ${pct}%`;
                if (pct < 50) {
                    statusEl.style.color = "#ff0055"; // Warning Red
                } else {
                    statusEl.style.color = "#00ffea"; // Normal Cyan
                }
            }
        }

        class Bot {
            constructor(x, y) {
                this.x = x; this.y = y;
                this.vx = (Math.random() - 0.5) * 12; 
                this.vy = (Math.random() - 0.5) * 12;
                this.size = 2; this.color = '#00ffea'; 
                this.target = null; this.state = 'HUNTING'; this.energy = 0;
            }

            update() {
                if(matrixActive) return; 

                if (this.state === 'HUNTING') {
                    this.x += this.vx; this.y += this.vy;
                    if(this.x < 0 || this.x > width) this.vx *= -1;
                    if(this.y < 0 || this.y > height) this.vy *= -1;

                    let minDist = Infinity; 
                    let closest = null;
                    let foodRemaining = false;

                    foodSources.forEach(food => {
                        if (food.integrity > 0) {
                            foodRemaining = true;
                            const dx = food.cx - this.x;
                            const dy = food.cy - this.y;
                            const dist = Math.sqrt(dx*dx + dy*dy);
                            if (dist < minDist) { minDist = dist; closest = food; }
                        }
                    });

                    if (closest) { 
                        const angle = Math.atan2(closest.cy - this.y, closest.cx - this.x);
                        this.vx += Math.cos(angle) * 0.6;
                        this.vy += Math.sin(angle) * 0.6;
                        this.vx *= 0.96; this.vy *= 0.96;
                        if (this.x > closest.x && this.x < closest.x + closest.w &&
                            this.y > closest.y && this.y < closest.y + closest.h) {
                            this.state = 'EATING'; this.target = closest;
                        }
                    } else {
                        if(!endSequenceReady && !foodRemaining) {
                            endSequenceReady = true;
                            document.getElementById('end-btn').style.display = 'block';
                        }

                        const dx = cx - this.x;
                        const dy = cy - this.y;
                        const dist = Math.sqrt(dx*dx + dy*dy);
                        this.vx += (dx / dist) * 0.5; this.vy += (dy / dist) * 0.5;
                        this.vx *= 0.95; this.vy *= 0.95;
                        this.color = '#ff0055';
                    }
                }

                if (this.state === 'EATING') {
                    this.vx *= 0.2; this.vy *= 0.2;
                    this.x += (Math.random()-0.5) * 4; this.y += (Math.random()-0.5) * 4;
                    this.color = '#ff0055'; 

                    if (this.target && this.target.integrity > 0) {
                        this.target.integrity -= 0.02; // SLOW SPEED
                        this.energy += 0.05; 
                        
                        const decay = this.target.integrity / 100;
                        this.target.dom.style.opacity = decay;
                        this.target.dom.style.transform = `translate(${(Math.random()-0.5)*4}px, ${(Math.random()-0.5)*4}px) scale(${decay})`;
                        this.target.dom.style.filter = `blur(${8 - (decay*8)}px) hue-rotate(${100 - this.target.integrity}deg)`;
                        
                        if (this.energy > 80) {
                            this.energy = 0;
                            const spawn = new Bot(this.x, this.y);
                            spawn.vx = (Math.random() - 0.5) * 10; spawn.vy = (Math.random() - 0.5) * 10;
                            bots.push(spawn); 
                        }
                    } else {
                        this.state = 'HUNTING'; this.target = null;
                        this.vx = (Math.random() - 0.5) * 25; this.vy = (Math.random() - 0.5) * 25;
                    }
                }
            }

            draw() {
                ctx.fillStyle = this.color;
                ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2); ctx.fill();
            }
        }

        document.getElementById('start-btn').addEventListener('click', (e) => {
            e.target.style.display = 'none'; active = true; scanDOM();
            const rect = e.target.getBoundingClientRect();
            const startX = rect.left + rect.width/2; const startY = rect.top + rect.height/2;
            for(let i=0; i<20; i++) bots.push(new Bot(startX, startY));
        });

        document.getElementById('end-btn').addEventListener('click', (e) => {
            e.target.style.display = 'none';
            matrixActive = true;
            document.getElementById('matrix-layer').style.opacity = '1';
            document.getElementById('ui-layer').style.opacity = '0';
            setTimeout(() => { document.getElementById('blackout').style.opacity = '1'; }, 3000);
        });

        function drawCursor() {
            cx += (mx - cx) * 0.15; cy += (my - cy) * 0.15;
            if(document.getElementById('blackout').style.opacity === '1') return;

            ctx.fillStyle = '#00ffea'; ctx.beginPath(); ctx.arc(cx, cy, 2, 0, Math.PI * 2); ctx.fill();
            ctx.strokeStyle = 'rgba(0, 255, 234, 0.5)'; ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(cx - 15, cy); ctx.lineTo(cx + 15, cy); 
            ctx.moveTo(cx, cy - 15); ctx.lineTo(cx, cy + 15); 
            ctx.stroke();
        }

        function drawMatrix() {
            mCtx.fillStyle = "rgba(0, 0, 0, 0.05)";
            mCtx.fillRect(0, 0, mCanvas.width, mCanvas.height);
            mCtx.fillStyle = "#0F0"; mCtx.font = "15px monospace";
            for(let i = 0; i < drops.length; i++) {
                const text = String.fromCharCode(0x30A0 + Math.random() * 96);
                mCtx.fillText(text, i * 20, drops[i] * 20);
                if(drops[i] * 20 > mCanvas.height && Math.random() > 0.975) drops[i] = 0;
                drops[i]++;
            }
        }

        function animate() {
            ctx.clearRect(0, 0, width, height);
            
            if(active && !matrixActive) {
                updateSystemStatus(); // Update % Text
                bots.forEach(b => { b.update(); b.draw(); });
                ctx.strokeStyle = 'rgba(0, 255, 234, 0.15)'; ctx.lineWidth = 0.5;
                ctx.beginPath();
                for(let i=0; i<bots.length; i++) {
                    const limit = Math.min(bots.length, i + 10);
                    for(let j=i+1; j<limit; j++) {
                        const dx = bots[i].x - bots[j].x;
                        const dy = bots[i].y - bots[j].y;
                        const d = Math.sqrt(dx*dx + dy*dy);
                        if (d < 40) { ctx.moveTo(bots[i].x, bots[i].y); ctx.lineTo(bots[j].x, bots[j].y); }
                    }
                }
                ctx.stroke();
            }
            if(matrixActive) drawMatrix();
            drawCursor();
            requestAnimationFrame(animate);
        }
        animate();
    </script>
</body>
</html>